{
  "nodes": [
    {
      "parameters": {
        "inputSource": "jsonExample",
        "jsonExample": "{\n  \"FILE_1\": \"FILENAME_1\",\n  \"FILE_2\": \"FILENAME_2\",\n  \"EFFECT\": \"fade\",\n  \"MAIN_VIDEO_DURATION\": 100,\n  \"PREFIX\": \"PREFIXO IDENTIFICADOR\",\n  \"TIMESTAMP\": 0\n}"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        0,
        -96
      ],
      "id": "9bb30f0d-b063-47ec-8052-10db8c99d87b",
      "name": "START"
    },
    {
      "parameters": {
        "content": "## ðŸŽ¬ Efeitos de transiÃ§Ã£o no FFmpeg (xfade)\n\n- **fade** â†’ crossfade clÃ¡ssico (dissolve)\n- **fadeblack** â†’ fade para preto\n- **fadewhite** â†’ fade para branco\n- **distance** â†’ efeito de zoom/distÃ¢ncia\n\n### Wipes\n- **wipeleft**\n- **wiperight**\n- **wipeup**\n- **wipedown**\n\n### Slides\n- **slideleft**\n- **slideright**\n- **slideup**\n- **slidedown**\n\n### Formas geomÃ©tricas\n- **circleopen** â†’ abre em cÃ­rculo\n- **circleclose** â†’ fecha em cÃ­rculo\n- **rectcrop** â†’ abre/fecha em retÃ¢ngulo\n\n### Efeitos especiais\n- **dissolve**\n- **pixelize**\n- **radial**\n",
        "height": 720,
        "width": 512,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        320,
        -112
      ],
      "typeVersion": 1,
      "id": "4dbd99a2-23e1-4c87-b692-b2a563304926",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "jsCode": "\n// ====== CONFIG INICIAL ======\nconst prefix = ($('START').first().json.TIMESTAMP +'_'+ $('START').first().json.PREFIX|| 'OUT').toString();  \n// se nÃ£o vier nada, usa \"OUT\"\n\n// FunÃ§Ã£o auxiliar: gera timestamp (em segundos inteiros)\nfunction getTimestamp() {\n  return Math.floor(Date.now() / 1000); \n}\n\n// Entradas vindas do JSON/nodes do n8n\nconst file1  = $('START').first().json.FILE_1;     // ex: \"video1.mp4\"\nconst file2  = $('START').first().json.FILE_2;     // ex: \"video2.mp4\"\nconst effect = ($('START').first().json.EFFECT || 'fade').toString();\nconst channelName = $('@GLOBAL_ANCAPSU').first().json.CHANNEL_NAME;\n\n\n\nconst fadeDur = 2; // padrÃ£o 2s\n\n// DuraÃ§Ã£o total do 1Âº vÃ­deo (em segundos)\nconst mainDur = Number($('START').first().json.MAIN_VIDEO_DURATION);\n\n// offset = fim do vÃ­deo1 - duraÃ§Ã£o do fade; fallback = 5s\nconst offset  = Number.isFinite(mainDur) ? Math.max(0, mainDur - fadeDur) : 5;\n\n// Helpers para nome\nconst baseName = f => f.replace(/\\.mp4$/i, '');\nconst safe = s => baseName(s).replace(/[^A-Za-z0-9_\\-]/g, '_');\n\n// Nome de saÃ­da de referÃªncia (sem timestamp)\nconst outFile = `CROSSFADE_${effect}_${safe(file1)}_${safe(file2)}.mp4`;\n\n// Nome final para upload â†’ agora com prefix + timestamp\nconst ts = getTimestamp();\nconst finalOut = `/home/node/processing/${channelName}/READY_TO_UPLOAD_${prefix}_${ts}.mp4`;\n\n// Comando FFmpeg\nconst cmd =\n  `ffmpeg -y ` +\n  `-i \"/home/node/processing/${channelName}/${file1}\" -i \"${file2}\" ` +\n  `-filter_complex \"` +\n    `[0:v]fps=30,settb=AVTB,setpts=PTS-STARTPTS,format=yuv420p,setsar=1[v0]; ` +\n    `[1:v]fps=30,settb=AVTB,setpts=PTS-STARTPTS,format=yuv420p,setsar=1[v1]; ` +\n    `[0:a]aformat=sample_fmts=fltp:sample_rates=44100:channel_layouts=stereo[a0]; ` +\n    `[1:a]aformat=sample_fmts=fltp:sample_rates=44100:channel_layouts=stereo[a1]; ` +\n    `[v0][v1]xfade=transition=${effect}:duration=${fadeDur}:offset=${offset}[v]; ` +\n    `[a0][a1]acrossfade=d=${fadeDur}[a]\" ` +\n  `-map \"[v]\" -map \"[a]\" ` +\n  `-c:v libx264 -pix_fmt yuv420p -profile:v high -level:v 4.1 -movflags +faststart ` +\n  `-c:a aac -b:a 192k ` +\n  `\"${finalOut}\"`;\n\nreturn {\n  command: cmd,\n  outputFile: outFile,  \n  finalOutput: finalOut,\n  debug: { MAIN_VIDEO_DURATION: mainDur, fadeDur, offset, prefix, timestamp: ts }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        880,
        -96
      ],
      "id": "5fa7e7fc-2809-420e-b8b4-cf3c0ea979b1",
      "name": "C0DE"
    },
    {
      "parameters": {
        "command": "={{ $json.command }}"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        1184,
        -96
      ],
      "id": "3179452f-af18-49a6-8ada-328b05e7c909",
      "name": "COMMAND"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1040,
        -96
      ],
      "id": "535e795b-ce26-41fb-a8b8-ffd21e52f9fd",
      "name": "Wait",
      "webhookId": "1982499d-410a-4032-826b-5924d19e4b4a"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "156aa925-b11e-4b2f-b75a-1f5b43edccb5",
              "name": "finalOutput",
              "value": "={{ $('C0DE').item.json.finalOutput.split('/')[$('C0DE').item.json.finalOutput.split('/').length-1] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1344,
        -96
      ],
      "id": "b60840ce-35af-4d96-9b39-6f51e3272a94",
      "name": "return"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "JgwCIAgZpZMMdgDf",
          "mode": "list",
          "cachedResultUrl": "/workflow/JgwCIAgZpZMMdgDf",
          "cachedResultName": "@GLOBAL_ANCAPSU"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {}
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        176,
        -96
      ],
      "id": "cc44b4c9-e22e-44c0-9007-a732c29871cf",
      "name": "@GLOBAL_ANCAPSU"
    }
  ],
  "connections": {
    "START": {
      "main": [
        [
          {
            "node": "@GLOBAL_ANCAPSU",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "C0DE": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "COMMAND": {
      "main": [
        [
          {
            "node": "return",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "COMMAND",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "@GLOBAL_ANCAPSU": {
      "main": [
        [
          {
            "node": "C0DE",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {
    "START": [
      {
        "FILE_1": "FADE_IN_FADE_OUT_OVERLAY_orientated_short_0_EG7qAwnz394_10_55.mp4",
        "FILE_2": "/home/node/assets/CANAL_ANCAPSU/final_videos/final-short.mp4",
        "EFFECT": "fadeblack",
        "MAIN_VIDEO_DURATION": 46.824349,
        "PREFIX": "IDX_0_SHORT",
        "TIMESTAMP": 1759606338194
      }
    ]
  },
  "meta": {
    "instanceId": "c5b0b17754dd8875e0a1c41ee11cdaba0d71678620daa90e860fc2877504e04a"
  }
}