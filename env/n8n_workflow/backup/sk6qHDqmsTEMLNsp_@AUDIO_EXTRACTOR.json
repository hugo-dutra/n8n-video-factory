{
  "updatedAt": "2025-10-09T00:20:56.000Z",
  "createdAt": "2025-08-20T21:09:28.255Z",
  "id": "sk6qHDqmsTEMLNsp",
  "name": "@AUDIO_EXTRACTOR",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "inputSource": "jsonExample",
        "jsonExample": "{\n  \"VIDEO_ID\": \"a string\"\n}"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -160,
        -112
      ],
      "id": "9e0b6a69-2afd-4de2-93be-ae1722498e13",
      "name": "START"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dff10386-aac1-4bf2-a53e-24e2e7441381",
              "name": "VIDEO_ID",
              "value": "={{ $('START').item.json.VIDEO_ID }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        192,
        -112
      ],
      "id": "8d3ccd10-b282-4ec0-b2f7-ff7f5c99e3ee",
      "name": "VAR"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9dffd76e-b0cf-4562-a4bf-3ae398e7ba30",
              "leftValue": "={{ $json.VIDEO_ID }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        336,
        -112
      ],
      "id": "e4d164e0-ecf0-4583-aa99-cf083a30b149",
      "name": "HAS_CHANNEL_ID"
    },
    {
      "parameters": {
        "errorMessage": "CHANNEL ID NOT FOUND"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        544,
        0
      ],
      "id": "03b9359b-2915-486a-bfc7-dad60717b764",
      "name": "ERROR"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4aa43995-1d25-4eac-949f-6ed21d4ab940",
              "name": "=RESULT",
              "value": "={{ $json.exitCode === 0? \"SUCCESS\":\"ERROR\"}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1056,
        -208
      ],
      "id": "525dc60b-0f7f-4be9-90f6-0c0d45cd1623",
      "name": "RESULT"
    },
    {
      "parameters": {
        "command": "=/bin/bash -lc '\nset -euo pipefail\n\nIN=\"/home/node/download/{{ $('@GLOBAL_ANCAPSU').item.json.CHANNEL_NAME }}/{{ $('START').first().json.VIDEO_ID }}/{{ $('START').first().json.VIDEO_ID }}.mp4\"\nOUT=\"${IN%.*}.mp3\"\nERR=\"/tmp/ffmpeg_$$.log\"\n\n# Duração do vídeo (mesmo esquema da opção A)\nVDUR=\"$(ffprobe -v error -select_streams v:0 -show_entries stream=duration \\\n  -of default=nw=1:nk=1 \"$IN\" | awk '\\''{d=$1+0; if(d<=0)d=0; print d}'\\'')\"\nif [ -z \"$VDUR\" ] || awk \"BEGIN{exit !($VDUR<=0)}\"; then\n  VDUR=\"$(ffprobe -v error -show_entries format=duration -of default=nw=1:nk=1 \"$IN\" \\\n    | awk '\\''{d=$1+0; if(d<=0)d=0; print d}'\\'')\"\nfi\nCUT=\"$(awk \"BEGIN { d=$VDUR; if(d>0.1) d=d-0.05; print d }\")\"\n\nffprobe -v error -select_streams a -show_entries stream=index -of csv=p=0 \"$IN\" >/dev/null\n\n# MP3: força CBR e sample-rate fixo, escreve header Xing (melhora estimativa de players)\nffmpeg -hide_banner -nostats -y \\\n  -ss 0 -i \"$IN\" \\\n  -map 0:a:0? -vn -sn -dn \\\n  -af \"aresample=async=1:first_pts=0,asetpts=PTS-STARTPTS\" \\\n  -ar 48000 -ac 2 -c:a libmp3lame -b:a 192k -write_xing 1 \\\n  -to \"$CUT\" -shortest \\\n  \"$OUT\" 2>\"$ERR\"\n\nprintf \"%s\\n\" \"$OUT\"\n'\n"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        896,
        -208
      ],
      "id": "ca219805-248e-4a2d-9ea8-c983dab5af66",
      "name": "EXTRACT",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "DOfnd0M834V8kbv2",
          "mode": "list",
          "cachedResultUrl": "/workflow/DOfnd0M834V8kbv2",
          "cachedResultName": "@CREATE_FOLDER"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "path": "=/home/node/download/{{ $('@GLOBAL_ANCAPSU').item.json.CHANNEL_NAME }}/{{ $('START').first().json.VIDEO_ID }}"
          },
          "matchingColumns": [
            "path"
          ],
          "schema": [
            {
              "id": "path",
              "displayName": "path",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        544,
        -208
      ],
      "id": "f83cf0ca-34b7-4b64-a11a-7ebe5966c5e9",
      "name": "CREATE_FOLDER"
    },
    {
      "parameters": {
        "amount": 3
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        720,
        -208
      ],
      "id": "31a96440-0ad2-4430-831c-fb1fad3927b4",
      "name": "Wait",
      "webhookId": "547564a2-960d-47a6-98d0-0f45f7c59244"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "JgwCIAgZpZMMdgDf",
          "mode": "list",
          "cachedResultUrl": "/workflow/JgwCIAgZpZMMdgDf",
          "cachedResultName": "@GLOBAL_ANCAPSU"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {}
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        16,
        -112
      ],
      "id": "fff818fe-5532-4558-8cc8-4acd618e5a30",
      "name": "@GLOBAL_ANCAPSU"
    }
  ],
  "connections": {
    "START": {
      "main": [
        [
          {
            "node": "@GLOBAL_ANCAPSU",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VAR": {
      "main": [
        [
          {
            "node": "HAS_CHANNEL_ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HAS_CHANNEL_ID": {
      "main": [
        [
          {
            "node": "CREATE_FOLDER",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ERROR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EXTRACT": {
      "main": [
        [
          {
            "node": "RESULT",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CREATE_FOLDER": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "EXTRACT",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "@GLOBAL_ANCAPSU": {
      "main": [
        [
          {
            "node": "VAR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "instanceId": "e562edbe74086864fad96dc54f91d130f73a43f334e27062d34cbaf271013692"
  },
  "pinData": {
    "START": [
      {
        "json": {
          "VIDEO_ID": "97nFoYay0IQ"
        }
      }
    ]
  },
  "versionId": "6d4fac57-9521-426a-afea-374fb24f18dc",
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-08-20T21:09:28.278Z",
      "createdAt": "2025-08-20T21:09:28.278Z",
      "role": "workflow:owner",
      "workflowId": "sk6qHDqmsTEMLNsp",
      "projectId": "TH7SrF7Rx9ho2z9i",
      "project": {
        "updatedAt": "2025-08-20T20:53:20.326Z",
        "createdAt": "2025-08-20T20:52:17.088Z",
        "id": "TH7SrF7Rx9ho2z9i",
        "name": "Hugo Dutra <hugo.dutra@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "updatedAt": "2025-08-20T20:52:17.089Z",
            "createdAt": "2025-08-20T20:52:17.089Z",
            "userId": "96b62bee-ebb1-4fe5-a51b-c116ef7064eb",
            "projectId": "TH7SrF7Rx9ho2z9i",
            "user": {
              "updatedAt": "2025-10-31T11:21:43.000Z",
              "createdAt": "2025-08-20T20:52:15.066Z",
              "id": "96b62bee-ebb1-4fe5-a51b-c116ef7064eb",
              "email": "hugo.dutra@hotmail.com",
              "firstName": "Hugo",
              "lastName": "Dutra",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-08-20T20:56:08.200Z",
                "personalization_survey_n8n_version": "1.107.4",
                "automationGoalDevops": [
                  "other"
                ],
                "automationGoalDevopsOther": "Video As A Service",
                "companySize": "<20",
                "companyType": "saas",
                "role": "engineering",
                "reportedSource": "youtube"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "DOfnd0M834V8kbv2",
                "userActivatedAt": 1755725592234,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1757188846991
                },
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsCalloutHttpRequest": true,
                  "preBuiltAgentsModalCallout": true
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-10-31",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}